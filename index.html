<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ŸÖŸàŸÇÿπ ÿ±ŸäÿßŸÜ</title>
  <style>
    body {
      background: linear-gradient(135deg, #001f3f, #0074D9);
      color: white;
      font-family: "Cairo", sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
    }

    h1 {
      margin: 20px 0;
      font-size: 28px;
      color: #00FFFF;
      text-shadow: 0 0 10px #00FFFF, 0 0 20px #0099FF;
    }

    canvas {
      border: 3px solid #00FFFF;
      background-color: #111;
      border-radius: 10px;
      box-shadow: 0 0 25px rgba(0, 255, 255, 0.4);
      margin-bottom: 20px;
    }

    .controls {
      display: grid;
      grid-template-columns: 60px 60px 60px;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }

    .controls button {
      background: linear-gradient(145deg, #00bcd4, #007acc);
      border: none;
      border-radius: 10px;
      color: white;
      font-size: 22px;
      padding: 10px;
      box-shadow: 0 0 10px rgba(0,255,255,0.5);
      cursor: pointer;
      transition: 0.2s;
    }

    .controls button:active {
      transform: scale(0.9);
      background: linear-gradient(145deg, #007acc, #00bcd4);
    }

    .row {
      display: flex;
      justify-content: center;
      align-items: center;
    }
  </style>
</head>
<body>

  <h1>üéÆ ŸÖŸàŸÇÿπ ÿ±ŸäÿßŸÜ üéÆ</h1>
  <canvas id="gc" width="400" height="400"></canvas>

  <div class="controls">
    <div></div>
    <button id="up">‚¨ÜÔ∏è</button>
    <div></div>

    <button id="left">‚¨ÖÔ∏è</button>
    <button id="down">‚¨áÔ∏è</button>
    <button id="right">‚û°Ô∏è</button>
  </div>

  <script>
    var Snake = (function () {

      const INITIAL_TAIL = 4;
      var fixedTail = true;
      var intervalID;
      var tileCount = 10;
      var gridSize = 400/tileCount;

      const INITIAL_PLAYER = { x: Math.floor(tileCount / 2), y: Math.floor(tileCount / 2) };
      var velocity = { x:0, y:0 };
      var player = { x: INITIAL_PLAYER.x, y: INITIAL_PLAYER.y };
      var walls = false;
      var fruit = { x:1, y:1 };
      var trail = [];
      var tail = INITIAL_TAIL;
      var reward = 0;
      var points = 0;
      var pointsMax = 0;

      var ActionEnum = { 'none':0, 'up':1, 'down':2, 'left':3, 'right':4 };
      Object.freeze(ActionEnum);
      var lastAction = ActionEnum.none;

      function setup () {
        canv = document.getElementById('gc');
        ctx = canv.getContext('2d');
        game.reset();
      }

      var game = {
        reset: function () {
          ctx.fillStyle = 'grey';
          ctx.fillRect(0, 0, canv.width, canv.height);
          tail = INITIAL_TAIL;
          points = 0;
          velocity.x = 0;
          velocity.y = 0;
          player.x = INITIAL_PLAYER.x;
          player.y = INITIAL_PLAYER.y;
          reward = -1;
          lastAction = ActionEnum.none;
          trail = [];
          trail.push({ x: player.x, y: player.y });
          this.RandomFruit();
        },

        action: {
          up: function () { if (lastAction != ActionEnum.down){ velocity.x = 0; velocity.y = -1; } },
          down: function () { if (lastAction != ActionEnum.up){ velocity.x = 0; velocity.y = 1; } },
          left: function () { if (lastAction != ActionEnum.right){ velocity.x = -1; velocity.y = 0; } },
          right: function () { if (lastAction != ActionEnum.left){ velocity.x = 1; velocity.y = 0; } }
        },

        RandomFruit: function () {
          fruit.x = Math.floor(Math.random() * tileCount);
          fruit.y = Math.floor(Math.random() * tileCount);
        },

        loop: function () {
          reward = -0.1;
          if(player.x < 0) player.x = tileCount-1;
          if(player.x >= tileCount) player.x = 0;
          if(player.y < 0) player.y = tileCount-1;
          if(player.y >= tileCount) player.y = 0;

          var stopped = velocity.x == 0 && velocity.y == 0;
          player.x += velocity.x;
          player.y += velocity.y;

          if (velocity.x == 0 && velocity.y == -1) lastAction = ActionEnum.up;
          if (velocity.x == 0 && velocity.y == 1) lastAction = ActionEnum.down;
          if (velocity.x == -1 && velocity.y == 0) lastAction = ActionEnum.left;
          if (velocity.x == 1 && velocity.y == 0) lastAction = ActionEnum.right;

          ctx.fillStyle = 'rgba(40,40,40,0.8)';
          ctx.fillRect(0,0,canv.width,canv.height);

          if (!stopped){
            trail.push({x:player.x, y:player.y});
            while(trail.length > tail) trail.shift();
          }

          ctx.fillStyle = 'green';
          for(var i=0; i<trail.length-1; i++) {
            ctx.fillRect(trail[i].x * gridSize+1, trail[i].y * gridSize+1, gridSize-2, gridSize-2);
            if (!stopped && trail[i].x == player.x && trail[i].y == player.y){
              game.reset();
            }
            ctx.fillStyle = 'lime';
          }
          ctx.fillRect(trail[trail.length-1].x * gridSize+1, trail[trail.length-1].y * gridSize+1, gridSize-2, gridSize-2);

          if (player.x == fruit.x && player.y == fruit.y) {
            if(!fixedTail) tail++;
            points++;
            if(points > pointsMax) pointsMax = points;
            reward = 1;
            game.RandomFruit();
          }

          ctx.fillStyle = 'red';
          ctx.fillRect(fruit.x * gridSize+1, fruit.y * gridSize+1, gridSize-2, gridSize-2);

          ctx.fillStyle = 'white';
          ctx.font = "bold small-caps 16px Helvetica";
          ctx.fillText("ÿßŸÑŸÜŸÇÿßÿ∑: " + points, 280, 40);
        }
      }

      function keyPush (evt) {
        switch(evt.keyCode) {
          case 37: game.action.left(); break;
          case 38: game.action.up(); break;
          case 39: game.action.right(); break;
          case 40: game.action.down(); break;
          case 32: Snake.pause(); break;
          case 27: game.reset(); break;
        }
      }

      return {
        start: function (fps = 15) {
          window.onload = setup;
          intervalID = setInterval(game.loop, 1000 / fps);
        },
        setup: {
          keyboard: function (state) {
            if (state) document.addEventListener('keydown', keyPush);
            else document.removeEventListener('keydown', keyPush);
          },
          fixedTail: function (state) { fixedTail = state; }
        },
        action: function (dir) { game.action[dir](); },
        pause: function () { velocity.x = 0; velocity.y = 0; }
      };
    })();

    Snake.start(8);
    Snake.setup.keyboard(true);
    Snake.setup.fixedTail(false);

    // ÿ±ÿ®ÿ∑ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿ®ÿßŸÑÿßÿ™ÿ¨ÿßŸáÿßÿ™
    document.getElementById("up").onclick = () => Snake.action("up");
    document.getElementById("down").onclick = () => Snake.action("down");
    document.getElementById("left").onclick = () => Snake.action("left");
    document.getElementById("right").onclick = () => Snake.action("right");
  </script>

</body>
</html>